## Leios

Inside the tools package is a Storm-IR implementation of the static
program analysis of "Continualization of Probabilistic Programs With
Correction" (Laurel et al. ESOP 2020). 

Given a probabilistic program template as input, Leios statically analyzes and replaces all
discrete and hybrid discrete-continuous distributions with continuous relaxations
to speed up inference. The following continuous relaxations are used:

Poisson => Normal
Binomial => Normal
Constant => Normal
Bernoulli => Beta

Leios then applies continuity correction to affected branch predicates:
"a==b" => "a <= b + Hole1 && a >= b - Hole2"

Note that the output program still contains the holes (as the Storm-IR only handles static program transformations).
Leios has a separate dynamic analysis to determine the optimal values for these holes.

### Prerequisites

```
java
maven
```

If you installed the Storm framework, nothing else is required

### Leios Class Structure

The `Continualizer`, `DistributionMutator`, and `PredicateCorrector` classes found in `src/main/java/tool/leios` implement the static program analysis and perform an IR-level transform. Thus given a .template file (file extension for the Storm IR language), these classes generate the continualized transformation of the program.


As the continualized/transform program still lives in the IR level,
one can translate it to an actual language, like Pyro.  Storm-IR
supports translators to multiple languages.




### Running Leios
This utility is fully contained in the JAR and everything can be done
from command line. From the root directory, one simply runs:

`java -cp target/grammar-1.0.jar tool.leios.LeiosMain [template-path] [output-language]`

Thus for example:

`java -cp target/grammar-1.0.jar tool.leios.LeiosMain src/test/resources/continualization.template pyro`

or:

`java -cp target/grammar-1.0.jar tool.leios.LeiosMain src/test/resources/continualization.template stan`

The implementation will output a `.png` of the CFG before applying the transformation, as well as the source code 
before applying the transformation (preTransformOutput) in the specified `output-language`.

The source code after applying the transform will be output in the postTransformOutput file.

### Integrating Leios

Note the above assumes one has a `.template` file on hand (which can
easily be generated by the parser for the Storm-IR). However if one
does not wish to output the `.template` file only to have to read it
back in (such as if one wishes to use the continualization as an
intermediate pass before another pass) then one may simply call the
`Continualizer` methods inside their java code. One simply calls
`Continualizer.continualize()` and then the transformed CFG can be
retrieved via `Continualizer.getBuilder()`


If you use our framework for your research, please cite as:

```
@inproceedings{laurel2020cont,
  title={Continualization of Probabilistic Programs With Correction},
  author={Laurel, Jacob and Misailovic, Sasa},
  LONGbooktitle={the 29th European Symposium on Programming},
  booktitle={ESOP},
  year={2020},
}
```
